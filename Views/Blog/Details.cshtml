@model SmartCookFinal.Models.Blog

@{
    // Lấy ID người dùng hiện tại từ ViewBag để kiểm tra quyền xóa bình luận
    int? currentUserId = ViewBag.CurrentUserId as int?;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@Model.Title - SmartCook</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /*
                    =========================================================================================
                    STYLE V.4 - TÔNG MÀU XANH LÁ NHẠT (THEO HÌNH ẢNH MỚI) - ÁP DỤNG CHO TRANG DETAILS
                    =========================================================================================
                */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background-color: #F0F9F0; /* Nền xanh lá siêu nhạt */
            min-height: 100vh;
        }

        .page-wraper {
            background: #F0F9F0; /* Nền xanh lá siêu nhạt */
            min-height: 100vh;
        }

        /* Banner Section */
        .page-banner {
            position: relative;
            height: 300px;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            /* Sử dụng màu từ CSS variables đã định nghĩa */
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.8), rgba(22, 163, 74, 0.9)), url('~/upload/green.jpg') center/cover;
        }

            .page-banner h1 {
                font-size: 3.5rem;
                font-weight: 700;
                color: white;
                text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            }

        /* Breadcrumb */
        .breadcrumb-row {
            background: #C8E6C9; /* Màu xanh lá từ ảnh */
            padding: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-bottom: 1px solid #A5D6A7;
        }

        .breadcrumb-list {
            display: flex;
            list-style: none;
            gap: 0.5rem;
            align-items: center;
        }

            .breadcrumb-list li {
                color: #2E7D32;
                font-size: 0.9rem;
            }

                .breadcrumb-list li:not(:last-child)::after {
                    content: '→';
                    margin-left: 0.5rem;
                    color: #2E7D32;
                }

            .breadcrumb-list a {
                color: #1B5E20; /* Màu xanh đậm cho link */
                text-decoration: none;
                transition: color 0.3s ease;
                font-weight: 600;
            }

                .breadcrumb-list a:hover {
                    color: #4CAF50;
                }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .content-section {
            padding: 3rem 0;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            align-items: start;
        }

        /* Blog Post Card */
        .blog-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .blog-image {
            position: relative;
            height: 400px;
            overflow: hidden;
        }

            .blog-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

        .blog-content {
            padding: 2.5rem;
        }

        .blog-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            color: #556B2F; /* Olive đậm cho chữ phụ */
            font-size: 0.9rem;
        }

            .blog-meta i {
                color: #66BB6A; /* Xanh lá */
            }

        .blog-title {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.3;
            /* Hiệu ứng chữ gradient màu xanh */
            background: linear-gradient(135deg, #388E3C, #1B5E20);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .blog-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #4a5568;
            margin-bottom: 1.5rem;
        }

        .divider {
            height: 2px;
            background: linear-gradient(90deg, #66BB6A, #43A047, #66BB6A);
            border: none;
            margin: 2rem 0;
            border-radius: 1px;
        }

        /* Comments Section */
        .comments-section {
            margin-top: 3rem;
        }

        .comments-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #1B5E20; /* Xanh đậm */
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

            .comments-title::before {
                content: '';
                width: 4px;
                height: 2rem;
                background: linear-gradient(135deg, #66BB6A, #43A047); /* Gradient xanh */
                border-radius: 2px;
            }

        .comment-item {
            background: #FAFFF9;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e8f5e9;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .comment-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #66BB6A, #43A047);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

            .comment-avatar img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }


        .comment-info h4 {
            font-weight: 600;
            color: #1B5E20;
            margin-bottom: 0.25rem;
        }

        .comment-date {
            color: #556B2F;
            font-size: 0.85rem;
        }

        .comment-text {
            line-height: 1.6;
            color: #4a5568;
        }

        /* Giữ lại màu đỏ cho nút xóa để cảnh báo người dùng */
        .delete-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

            .delete-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 15px rgba(239, 68, 68, 0.3);
            }

        /* Comment Form */
        .comment-form {
            background: #FAFFF9;
            border: 2px solid #C8E6C9;
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            position: relative;
        }

            .comment-form h3 {
                font-size: 1.6rem;
                font-weight: 600;
                background: linear-gradient(135deg, #4CAF50, #1B5E20);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 1.5rem;
            }

        .form-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background: white;
        }

            .form-textarea:focus {
                outline: none;
                border-color: #66BB6A;
                box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.2);
            }

        .submit-btn {
            background: linear-gradient(135deg, #66BB6A, #43A047);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .submit-btn:hover {
                background: linear-gradient(135deg, #4CAF50, #388E3C);
                transform: translateY(-3px);
                box-shadow: 0 12px 20px rgba(67, 160, 71, 0.3);
            }

        /* Sidebar */
        .sidebar-widget {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .widget-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1B5E20;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid transparent;
            background: linear-gradient(90deg, #66BB6A, #43A047) bottom/100% 2px no-repeat;
        }

        .search-input:focus {
            outline: none;
            border-color: #66BB6A;
            box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.2);
        }

        .search-btn {
            color: #4CAF50;
        }

            .search-btn:hover {
                color: #388E3C;
            }

        .recent-post-content a:hover {
            color: #4CAF50;
        }

        .floating-btn {
            background: linear-gradient(135deg, #66BB6A, #43A047);
            color: white;
            border: none;
            border-radius: 50%;
            box-shadow: 0 8px 20px rgba(67, 160, 71, 0.3);
        }
    </style>
</head>
<body>
    <div class="page-wraper">
        <div class="page-banner">
            <div class="container">
                <div class="page-banner-entry text-center">
                    <h1 class="text-white">Chi Tiết Bài Viết</h1>
                </div>
            </div>
        </div>

        <div class="breadcrumb-row">
            <div class="container">
                <ul class="breadcrumb-list">
                    <li><a href="@Url.Action("Index", "Home")">Trang chủ</a></li>
                    <li><a href="@Url.Action("Index", "Blog")">Blog</a></li>
                    <li>Chi tiết</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="container">
                <div class="main-content">
                    <div class="blog-section">
                        <article class="blog-card">
                            <div class="blog-image">
                                <img src="@Model.UrlImage" alt="@Model.Title">
                            </div>
                            <div class="blog-content">
                                <div class="blog-meta">
                                    <span><i class="fas fa-calendar-alt"></i> @Model.CreatedAt.ToString("dd/MM/yyyy")</span>
                                    <span><i class="fas fa-user"></i> @Model.User.TenNguoiDung</span>
                                </div>
                                <h1 class="blog-title">@Model.Title</h1>
                                <div class="content-text">
                                    <p style="font-weight: bold;">@Html.Raw(Model.Content)</p>
                                    <hr style="margin: 2rem 0;" />
                                    <div style="white-space: pre-line;">@Html.Raw(Model.Detail)</div>
                                </div>
                                <hr class="divider">
                            </div>
                        </article>

                        <div class="comments-section">
                            <h2 class="comments-title">
                                <i class="fas fa-comments"></i>
                                @(Model.Comments?.Count() ?? 0) @((Model.Comments?.Count() ?? 0) <= 1 ? "Bình luận" : "Bình luận")
                            </h2>

                            @foreach (var comment in Model.Comments)
                            {
                                <div class="comment-item">
                                    <div class="comment-header">
                                        <div class="comment-avatar">
                                            <img class="avatar photo" src="https://via.placeholder.com/50" alt="@comment.User.TenNguoiDung" />
                                        </div>
                                        <div class="comment-info">
                                            <h4>@comment.User.TenNguoiDung</h4>
                                            <span class="comment-date">@comment.CommentedAt.ToString("HH:mm 'ngày' dd/MM/yyyy")</span>
                                        </div>
                                    </div>
                                    <p class="comment-text">@comment.CommentText</p>

                                    @if (currentUserId != null && comment.UserId == currentUserId)
                                    {
                                        <form asp-controller="Blog" asp-action="DeleteComment" method="post">
                                            <input type="hidden" name="commentId" value="@comment.BlogCommentId" />
                                            <input type="hidden" name="blogId" value="@Model.BlogId" />
                                            <button type="submit" class="delete-btn" onclick="return confirm('Bạn có chắc muốn xóa bình luận này?');">
                                                <i class="fas fa-trash"></i> Xóa
                                            </button>
                                        </form>
                                    }
                                </div>
                            }

                            <form class="comment-form" asp-controller="Blog" asp-action="AddComment" method="post">
                                <h3><i class="fas fa-pen"></i> Để lại bình luận</h3>
                                <input type="hidden" name="BlogId" value="@Model.BlogId" />
                                <div class="form-group">
                                    <label for="comment">Bình luận của bạn</label>
                                    <textarea class="form-textarea" id="comment" name="CommentText" placeholder="Chia sẻ cảm nghĩ của bạn..." required></textarea>
                                </div>
                                <button type="submit" class="submit-btn">
                                    <i class="fas fa-paper-plane"></i> Gửi bình luận
                                </button>
                            </form>
                        </div>
                    </div>

                    <aside class="sidebar">
                        <div class="sidebar-widget">
                            <h3 class="widget-title">Tìm kiếm</h3>
                            <form class="search-box" role="search" method="get" asp-action="Index" asp-controller="Blog">
                                <input type="text" name="searchText" class="search-input" placeholder="Tìm công thức, mẹo...">
                                <button type="submit" class="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </form>
                        </div>

                        <div class="sidebar-widget">
                            <h3 class="widget-title">Bài viết gần đây</h3>
                            <div class="recent-posts">
                                @foreach (var post in (List<SmartCookFinal.Models.Blog>)ViewBag.RecentPosts)
                                {
                                    <article class="recent-post">
                                        <a asp-controller="Blog" asp-action="Details" asp-route-id="@post.BlogId" style="display: contents;">
                                            <div class="recent-post-image">
                                                <img src="@post.UrlImage" alt="@post.Title">
                                            </div>
                                            <div class="recent-post-content">
                                                <h6><a asp-controller="Blog" asp-action="Details" asp-route-id="@post.BlogId" style="text-decoration:none; color:inherit;">@post.Title</a></h6>
                                                <div class="recent-post-date">
                                                    <i class="fas fa-calendar-alt"></i> @post.CreatedAt.ToString("dd/MM/yyyy")
                                                </div>
                                            </div>
                                        </a>
                                    </article>
                                }
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </div>

        <button class="floating-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>
</body>
</html>